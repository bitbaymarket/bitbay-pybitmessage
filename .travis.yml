language: cpp
matrix:
  include:
    - os: linux
      dist: trusty
      sudo: required
      env: ARCH="linux64" DEPLOY_FILE=market_tracker_linux64.tgz
    - os: linux
      dist: trusty
      sudo: required
      env: ARCH="linux32" DEPLOY_FILE=market_tracker_linux32.tgz
    - os: osx
      osx_image: xcode7.3
      compiler: clang
      env: ARCH="mac" DEPLOY_FILE=market_tracker_mac.zip

install:
- export REPOL=https://github.com/bitbaymarket/bitbay-prebuilt-libs1
- export BASE2=$REPOL/releases/download/base2
- >
  if [[ $ARCH == "linux32" ]]; then
    sudo apt-get update                                         &&
    sudo apt-get install -y python:i386                         &&
    sudo apt-get install -y python-pip                          &&
    sudo apt-get install -y pyqt4-dev-tools:i386                &&
    sudo apt-get install -y python-crypto:i386                  &&
    python --version                                            &&
    which python                                                &&
    which pip                                                   &&
    sudo pip install pyinstaller                                &&
    sudo pip install pyzmail                                    &&
    sudo pip install stopit                                     &&
    sudo pip install password                                   &&
    sudo pip install appdirs                                    &&
    export                                                      ;
  fi &&
  if [[ $ARCH == "linux64" ]]; then
    sudo apt-get install -y pyqt4-dev-tools                     &&
    python --version                                            &&
    sudo pip install pyinstaller                                &&
    sudo pip install pyzmail                                    &&
    sudo pip install stopit                                     &&
    sudo pip install password                                   &&
    sudo pip install pycrypto                                   &&
    sudo pip install appdirs                                    &&
    export                                                      ;
  fi &&
  if [[ $ARCH == "mac" ]]; then
    export PATH="/usr/local/opt/python/libexec/bin:$PATH"       &&
    (brew doctor || echo skip)                                  &&
    (brew install ruby || echo skip)                            &&
    (brew install pyenv || echo skip)                           &&
    export PATH="/usr/local/opt/python/libexec/bin:$PATH"       &&
    export PATH="/usr/local/opt/python@2/libexec/bin:$PATH"     &&
    pyenv versions                                              &&
    brew tap cartr/qt4                                          &&
    brew tap-pin cartr/qt4                                      &&
    brew install pyqt@4                                         &&
    (brew install python@2 || brew link --overwrite python@2 || echo skip) &&
    export PATH="/usr/local/Cellar/python@2/2.7.15/bin:$PATH" &&
    python --version                                            &&
    pip install pyinstaller                                     &&
    pip install pyzmail                                         &&
    pip install stopit                                          &&
    pip install password                                        &&
    pip install pycrypto                                        &&
    pip install appdirs                                         &&
    export                                                       ;
  fi

before_script:
- export REPOL=https://github.com/bitbaymarket/bitbay-prebuilt-libs1
- export BASE2=$REPOL/releases/download/base2

script:
- cd "$TRAVIS_BUILD_DIR"
- ls
- pyinstaller bitbay/market_tracker.py -F -p src
- ls dist
- file dist/market_tracker
- >
  if [[ $ARCH == "linux32" ]]; then
    ldd dist/market_tracker                           &&
    mv dist/market_tracker .                          &&
    tar -zcf $DEPLOY_FILE market_tracker              ;
  fi &&
  if [[ $ARCH == "linux64" ]]; then
    ldd dist/market_tracker                           &&
    mv dist/market_tracker .                          &&
    tar -zcf $DEPLOY_FILE market_tracker              ;
  fi &&
  if [[ $ARCH == "mac" ]]; then
    otool -L dist/market_tracker                      &&
    mv dist/market_tracker .                          &&
    zip -r $DEPLOY_FILE market_tracker                ;
  fi

- file $DEPLOY_FILE

